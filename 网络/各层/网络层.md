# 网络层的作用
> 主要作用实现终端节点之间的通信，“点对点通信”。数据链路层的主要作用是互连的同一种数据链路节点之间进行包传递，一旦跨越多种数据链路就需要借助网络层。

- 主机: 配有IP地址，但是不进行路由控制（转发分组包）
- 节点： 主机和路由的统称

## 与数据链路层的关系
数据链路是提供直连两个设备之间的通信，网络层提供两个没有直连网络之间的通信传输，依赖于链路层“区间内”链路传输。


## IP协议

> 主要负责将数据包发送给目标计算机，主要分为三大作用模块：IP寻址、路由、IP分包和组包

通信对端，必须有一个类似地址的标示码，数据链路中MAC地址表示同一链路中的不同设备，IP地址的用于在连接到网络中的所有节点中识别出进行通信的地址。IP地址不会因为数据链路层的改变而改变，网络层对数据链路层的特性进行了抽象（透明化，当作看不见）。

网桥、交换集线器，或数据链路层转发设别，不需要设置IP地址，这些设备只负责IP包转化为1、0或者对数据链路帧进行转发。

## 路由控制
> 将分组数据发送最终目的地址

- Hop：“跳”，利用数据链路分层功能传输功能传输数据帧的一个区间。IP路由也叫做多跳路由

如何知道路径？

IP包被转发到某个路由是，实际是转入数据链路层的数据帧，目标MAC地址就是下一个路由的地址，到了下一个路由之后，根据**路由表**再决定发往哪个路由

### 分片

不同数据链路的MTU不同，需要将较大的IP包分成较小的IP包。到达目的地址以后，被组合传给上一层。IP是属于面向**无连接**的：1.为了简化 2:为了提速，IP提供**尽力服务**

分片的重组由目标主机进行，路由器做分片但是不会进行重组

使用PMTUD（p:Path d:Discovery）使用ICMP

# IP地址
> IPv4: 由32位组成，常使用十进制点分发，每8位为一组，分成4组

![](media/15404496897560.jpg)

## IP由网络和主机两部分组成
> IP地址由“网络地址”和“主机地址”两部分组成。192.168.128.10/24中1-24位为网络地址。

![](media/15404500921895.jpg)

## IP地址分类
> IP地址分为A、B、C、D（E未使用），主机标识全为1为广播地址，全为0为网络地址，不用于分配给主机

![](media/15404502270253.jpg)

- A类
1-8位标示网络地址，首位为0: 0.0.0.0～127.0.0.0

- B类
1-16为标示网络地址，首位为10：128.0.0.1～191.255.0.0

- C类
1-24为标示网络地址，首位为110：192.168.0.0～ 239.255.255.0

- D类
1-32为标示网络地址，首位为1110”：224.0.0.0～ 239.255.255.255

D类没有主机标识，常用于多播

## 广播地址
广播地址用于同一个链路中相互连接的主机之间发送数据包，将主机地址全部设为1，就是广播地址

>广播的IP包以数据链路的帧的形式发送，通过MAC地址全为1比特的 `FF：FF：FF：FF：FF：FF`转发。

`172.20.0.0/16`
`10101100.00010100.00000000.00000000`　的广播地址

`10101100.00010100.11111111.11111111`
`172.20.255.255`

广播分为：本地广播和直接广播
本地广播，为同一个网段中广播，不同链路中广播为直接广播。
由于直播广播存在安全问题，一般会被屏蔽。


## 多播
多播用于包发送给特定组内的所有主机，广播无法穿透路由，而多播可以穿透路由，在不同的网段中发送数据包。使用生存时间TTL限制包到达的范围

从224.0.0.0到239.255.255.255都是多播地址的可用范围。其中从 224.0.0.0到224.0.0.255的范围不需要路由控制，在同一个链路内也能实 现多播

## 子网掩码

由于IP确定了分类，就确定了网络标示和主机标示，直接使用ABC类地址浪费资源。为此使用新的方式组合减少浪费。将原来的A类、B类、C类的主机部分用做子网地址，将原网络分为多个物理网络的一种机制。
![](media/15405227759884.jpg)

## CIDR 与 VLSM
CIDR：采用任意长度分割IP地址的网络标示和主机标示（放弃IP地址的分类）
VLSM： 可变长子网掩码

## 全局地址与私有地址
全局地址：整个互联网范围内保持唯一（公网地址）
私有地址：在同一个域里保证唯一
使用NAT可以将私有IP与全局IP转换

全局地址由 ICANN 中文名叫“互联网名称与数字地址分配机构” 管理

## 路由控制

IP地址不足以将数据包发送到对端的目标地址，在数据发送过程中，还需要“指明路由器活主机的”信息，保存这种信息的就是路由表。

最长匹配：172.20/16和172.20.100/24 选择匹配的最长的172.20.100/24

默认路由：0.0.0.0/0或default （任何一个地址都能与之匹配的记录）
主机路由：“IP地址/32” 例如：192.168.153.15/32
路由表聚合：聚合减少路由表条目



# IP协议相关技术
主要有 DNS、ARP、ICMP、DHCP等

## DNS
DNS用于将域名（主机名）解析为IP地址，起初由互联网中心管理一份hosts文件，管理主机名和IP地址之间对应的关系。域名具有分层结构：主机名称和组织机构名称。

顶级域名：国家域名、特殊领域域名（edu、com（commercial商业组织））

域名服务器：分层，每层都有一个域名服务器。如同分布式数据库，不仅仅管理了主机名和IP地址之间的映射关系，还管理了其他信息：例如A记录

DNS查询：本层的域名服务器查询不到的时候，回向上一层查询，并保存到缓存里


## ARP

Address Resolution Protocol ：解决地址问题的协议，以目标IP为线索，定位一下接收数据分饱的网络对应的MAC地址。如果目标主机不在同一个链路，可以使用ARP，查找下一跳路由的MAC地址，仅适用于IPv4，IPv6的使用ICMPv6。

ARP请求将带有目标IP的地址广播，对应的主机发送ARP响应告诉其MAC地址（ARP请求同时也有告诉其他主机自己的MAC地址的作用）

### RARP
将MAC地址定位IP地址的一种协议。例如打印机服务器等小型嵌入式设备接入到网络的时候，会用到，设备会发送“我的MAC是XXX，我的IP地址是什么”然后RARP服务器应答，设置设备的IP地址。

## ICMP

10.8.4.0 | 0.0.0.255
10.8.4.255












